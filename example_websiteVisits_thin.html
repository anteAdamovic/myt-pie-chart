<html>

<head>
  <link href="c3.css" rel="stylesheet" type="text/css">
  <script src="d3.js"></script>
  <script src="c3.min.js"></script>
  <script src="myt-pie-chart.js"></script>

  <style>
    .chart {
      display: inline-block;
      border: 1px solid black;
    }

    #charts {
      text-align: center;
    }

    #visitors {
      text-align: center;
    }

    .chart-text {
      margin-top: 100px;
      margin-bottom: -145px;
    }

    #line *{
      stroke-width: 3px;
    }

    #line {
      width: 70%;
      margin: 0 auto;
    }

    #chart1_tooltip {
      opacity: 0;
      transition: opacity 10s;
    }

    #chart1_tooltip:hover{
      opacity: 1;
      transition: opacity 1s;
    }
  </style>
</head>
<body>
  <div>
    <input type="radio" name="line-type" value="Lines" checked onchange="changeToLines()"> Lines </input>
    <input type="radio" name="line-type" value="Bars" onchange="changeToBars()"> Bars </input>
  </div>
  <div id="visitors"> Total user accounts: 8,792,859 </div>
  <section id="charts">
    <div id="chart1" class="chart"></div>
    <div id="chart2" class="chart"><p class="chart-text">Stackoverflow<br/> <script> document.write(Math.round(((2030977-677176/2) / 8792859) * 100) + "%")</script></p></div>
    <div id="chart3" class="chart"><p class="chart-text">Linked<br/> <script> document.write(Math.round((677176 / 8792859) * 100) + "%")</script></p></div>
  </section>
  <div id="line"></div>
  <p style="text-align: center"> Monthly increase for year 2015 </p>
  <script>

  var line_chart = c3.generate({
    bindto: '#line',
    data: {
      columns: [
        ['Github', 600000, 550000, 700000, 650000, 650000, 600000, 700000, 500000, 550000, 600000, 500000, 650000, 700000],
        ['Stackoverflow', 150000, 160000, 170000, 160000, 170000, 150000, 160000, 165000, 170000, 160000, 175000, 180000, 150000],
        ['Linked', 50000, 51000, 52000, 53000, 54000, 55000, 56000, 57000, 58000, 59000, 60000, 61000, 62000]
      ],
      types: {
        Searches: 'line',
        Registrations: 'line',
        Subscriptions: 'line'
      },
      colors: {
        Github: '#3b5998',
        Stackoverflow: '#78ce5a',
        Linked: '#d73d32'
      }
    }
  });

  function changeToLines(){
    line_chart.transform('line');
  }

  function changeToBars(){
    line_chart.transform('bar');
  }

  var chart1_data_old = [
    {
      name: 'Github',
      value: 1,
      bgColor: '#3b5998',
      color: 'black'
    },
    {
      name: '',
      value: 99,
      bgColor: '#e6e6e6'
    }
  ];
  var chart1_data = [
    {
      name: 'Github',
      value: 7439058-677176/2,
      bgColor: '#3b5998',
      color: 'black'
    },
    {
      name: '',
      value: 8792859-7439058+677176/2,
      bgColor: '#e6e6e6'
    }
  ];
  var chart1 = mytPieChart.newChart();
  chart1.setData(chart1_data_old)
    .setWidth(360)
    .setHeight(240)
    .setContainer('chart1')
    .setId("chart1");

  chart1.title.setTextFunc(function(){
    return "Github";
  });
  chart1.title.position.setX(155);
  chart1.title.position.setY(120);

  // chart1.chart.label.setActive(false);
  chart1.chart.dimension.setCenterRadius(40);
  //chart1.tooltip.setActive(true);
  chart1.tooltip.position.setX(220);
  chart1.chart.label.position.dx = "-2.8em";
  chart1.chart.label.position.dy = "-1.2em";
  chart1.chart.font.setSize(16);

  chart1.chart.events.setOnMouseOver(function(d){
    if(d.data.name == '')
      return;

    var value = d.data.value;
    if(value > 1000000){
      d3.select(this).select("text").text("" + Math.round((value / 1000000)*100)/100 + "m");
      return;
    }
    else if(value > 1000){
      d3.select(this).select("text").text("~" + Math.round(value / 1000, -2) + "k");
      return;
    }
    else {
      d3.select(this).select("text").text("" + value + "");
      return;
    }

    d3.select(this).select("text").text(d.data.value);
  });
  chart1.chart.events.setOnMouseLeave(function(d){
    if(d.data.name == '')
      return;
    d3.select(this).select("text").text(Math.round((d.data.value / chart1total) * 100) + '%');
  });
  chart1.chart.events.setOnClick(function(d){
    if(d.data.name == '')
      return;

    console.log(d3.select(this).select("path").style("opacity"));

    if(d3.select(this).select("path").style("opacity") == 0.7){
      line_chart.show(d.data.name);
      d3.select(this).select("path").style("opacity", 1);
    }else{
      line_chart.hide(d.data.name);
      d3.select(this).select("path").style("opacity", 0.7);
    }
  });

  var chart1total = 0;
  for(var x = 0; x < chart1_data.length; x++){
    chart1total += chart1_data[x].value;
  }
  chart1.chart.label.setTextFunc(function(d){
    if(d.data.name == 'Github')
      return Math.round((d.data.value / chart1total) * 100) + '%';
  });
  chart1.title.setActive(true);

  chart1.display();

  chart1.setData(chart1_data);
  chart1.display();

  chart1.delete();
  chart1.display();


  var chart2_data_old = [
    {
      name: 'Stackoverflow',
      value: 1,
      bgColor: '#78ce5a',
      color: 'white'
    },
    {
      name: '',
      value: 99,
      bgColor: '#e6e6e6'
    }
  ];
  var chart2_data = [
    {
      name: 'Stackoverflow',
      value: 2030977-677176/2,
      bgColor: '#78ce5a',
      color: 'white'
    },
    {
      name: '',
      value: 8792859-2030977+677176/2,
      bgColor: '#e6e6e6'
    }
  ];
  var chart2 = mytPieChart.newChart();
  chart2.setData(chart2_data_old)
    .setWidth(400)
    .setHeight(240)
    .setContainer('chart2')
    .setId("_chart2");

  chart2.chart.label.setActive(false);
  chart2.chart.dimension.setCenterRadius(35);
  chart2.chart.label.position.dx = "-1.7em";
  chart2.chart.label.position.dy = "1.5em";

  var chart2total = 0;
  for(var x = 0; x < chart2_data.length; x++){
    chart2total += chart2_data[x].value;
  }
  chart2.chart.label.setTextFunc(function(d){
    if(d.data.name == 'Registrations')
    return Math.round((d.data.value / chart2total) * 100) + '%';
  });
  chart2.chart.events.setOnMouseOver();
  chart2.chart.events.setOnMouseLeave();
  chart2.chart.events.setOnClick(function(d){
    if(d3.select(this).select('path').style('opacity') == 0.7){
      d3.select(this).select('path').style('opacity', 1);
      line_chart.show(['Stackoverflow']);
    }
    else{
      d3.select(this).select('path').style('opacity', 0.7);
      line_chart.hide(['Stackoverflow']);
    }
  });
  chart2.display();

  chart2.setData(chart2_data);
  chart2.display();

  var chart3_data_old = [
    {
      name: 'Linked',
      value: 1,
      bgColor: '#d73d32',
      color: 'white'
    },
    {
      name: '',
      value: 99,
      bgColor: '#e6e6e6'
    }
  ];
  var chart3_data = [
    {
      name: 'Linked',
      value: 677176,
      bgColor: '#d73d32',
      color: 'white'
    },
    {
      name: '',
      value: 8792859-677176,
      bgColor: '#e6e6e6'
    }
  ];
  var chart3 = mytPieChart.newChart();
  chart3.setData(chart3_data_old)
    .setWidth(400)
    .setHeight(240)
    .setContainer('chart3')
    .setId("_chart3");

    chart3.chart.label.setActive(false);
    chart3.chart.dimension.setCenterRadius(35);
    chart3.chart.label.position.dx = "-1.0em";
    chart3.chart.label.position.dy = "0em";
    chart3.chart.font.setSize(12);
    var chart3total = 0;
    for(var x = 0; x < chart3_data.length; x++){
      chart3total += chart3_data[x].value;
    }
    chart3.chart.label.setTextFunc(function(d){
      if(d.data.name == 'Subscriptions')
      return Math.round((d.data.value / chart3total) * 100) + '%';
    });
    chart3.chart.events.setOnMouseOver();
    chart3.chart.events.setOnMouseLeave();
    chart3.chart.events.setOnClick(function(d){
      if(d3.select(this).select('path').style('opacity') == 0.7){
        d3.select(this).select('path').style('opacity', 1);
        line_chart.show(['Linked']);
      }
      else{
        d3.select(this).select('path').style('opacity', 0.7);
        line_chart.hide(['Linked']);
      }
    });
    chart3.display();

    chart3.setData(chart3_data);
    chart3.display();
  </script>
</body>

</html>
